<ion-modal-view class="activity view-section min-size">

    <ion-header-bar align-title="center">
        <button class="button button-icon ion-close-round" ng-click="vm.close('activityDetails')"></button>
        <h1 class="title">Activity Details</h1>
        <button class="button button-clear" ng-click="vm.likeActivity()" ng-if="vm.showLikeButton">Like Post</button>
    </ion-header-bar>

    <ion-pane class="pane has-footer details-activity-pane">
        <ion-scroll delegate-handle="mainScroll">
            <ion-item class="item">
                <div class="activity-item">
                    <div class="top">
                        <div class="panel">
                            <div class="visual" ng-if="!!vm.avatar || !!vm.user.props.avatar">
                                <img class="avatar" ng-src="{{vm.avatar || vm.user.props.avatar}}" />
                            </div>
                            <div class="text">
                                <div class="holder">
                                    <div class="activity-summary">
                                        <a ng-if="!!vm.username || !!vm.user.handle" class="user-link" ng-click="vm.viewUser($event)">
                                            <strong>{{vm.username || vm.user.handle}}</strong>
                                        </a>
                                    </div>
                                    <div class="time" ng-if="vm.entry.created">
                                        <i class="ico ico-timesmall"></i> {{vm.entry.created | date:'mediumDate'}}
                                    </div>
                                </div>
                                <div class="holder last-location" ng-if="vm.entry.location.placeName || vm.entry._location[0].placeName">
                                    <i class="ion-location"></i> {{vm.entry.location.placeName || vm.entry._location[0].placeName}}
                                </div>
                            </div>
                        </div>

                        <div class="title">{{ vm.entry.title }}</div>

                        <div class="clearfix props" ng-if="!vm.entry.company">
                            <div class="left notes" ng-class="{'active':!!vm.showNotes}" ng-if="!!vm.entry.notes" ng-click="vm.showNotes = !vm.showNotes">
                                <i class="icon ion-ios-list-outline"></i>
                                <span class="lbl">notes</span>&nbsp;
                                <i class="ion-chevron-up" ng-hide="!!vm.showNotes"></i>
                                <i class="ion-chevron-down" ng-show="!!vm.showNotes"></i>
                            </div>

                            <div class="right dist driven" ng-if="!!vm.entry.props.distance">
                                <i class="ico ico-milestraveledsmall"></i>
                                <span class="dist mi">{{vm.entry.props.distance}}</span>
                                <span class="lbl">Driven Today</span>
                            </div>

                            <div class="right freight" ng-if="!!vm.entry.props.freight">
                                <i class="ico ico-freight"></i>
                                <span>{{vm.entry.props.freight}}</span>
                            </div>
                        </div>
                        
                        <div class="notes-content" ng-if="!vm.entry.company" ng-show="!!vm.showNotes">
                            <span ng-bind="vm.entry.notes"></span>
                        </div>
                    </div>
                </div>
            </ion-item>

            <div class="map">
                <div id="map" data-tap-disabled="true" ng-if="vm.entry.location.coordinates.length > 0"></div>
                <static-gmap class="static-map" size="400x200" sensor="true" zoom="14" ng-if="!vm.entry.location.coordinates.length"></static-gmap>
            </div>
            

            <img ng-if="vm.entry.imageURL" ng-src="{{vm.entry.imageURL}}" class="static-pic">


            <div class="activity-item bottom" ng-if="!!vm.entry.company && !!vm.entry.notes">
                <div class="notes-content">
                    <span ng-bind="vm.entry.notes"></span>
                </div>
            </div>
            
            <div class="activity-item bottom">
                <div class="clearfix props">
                    <div class="driven left" ng-if="!!vm.entry.props.slMiles">
                        <i class="ion-checkmark"></i>
                        <span class="dist mi">{{vm.entry.props.slMiles}}</span>
                        <span class="lbl">since last checkin</span>
                    </div>

                    <div class="likes right" ng-if="!!vm.entry.likes" ng-click="vm.likeActivity(vm.entry.id, $event)">
                        <i class="ion-star"></i> {{vm.entry.likes.length}}
                        <span class="lbl">like{{vm.entry.likes.length != 1 ? 's' : ''}}</span>
                    </div>
                </div>
            </div>

            <div class="item-detail" ng-click="vm.toggleInput($event, true)">
                <div class="comments" ng-if="!!vm.entry.comments">
                    <i class="ion ion-chatboxes"></i> {{vm.entry.comments.length}}
                    <span class="lbl">comments</span>
                </div>
            </div>

            <div class="item comment" ng-repeat="message in vm.entry.comments" ng-click="vm.toggleInput($event, true)">
                <a>{{message.sender.displayName}}</a> {{message.text}}
                <div class="time-inline" ng-if="vm.entry.created">{{message.created | date:'mediumDate'}}</div>
            </div>
        </ion-scroll>
    </ion-pane>

    <ion-footer-bar ng-if="!vm.isInputVisible">
        <div class="button-bar action-buttons">
            <button class="button icon ion-ios-plus-outline primary" ng-click="vm.toggleInput($event, true)"> Comment</button>
        </div>
    </ion-footer-bar>

    <ion-footer-bar ng-if="vm.isInputVisible" class="bar bar-footer item-input-inset">
        <button class="button button-clear button-positive" ng-click="vm.toggleInput($event, false)"><i class="ion-close-round"></i></button>
        <ion-input class="item-input-wrapper message-textarea">
            <i class="ion ico-messagesiconblue"></i>
            <textarea focus-me="vm.focusComment" msd-elastic id="message-field" name="commentInput" placeholder="&nbsp;Comment" ng-model="vm.message"></textarea>
        </ion-input>
        <button class="button button-clear button-positive" ng-disabled="!vm.message" ng-click="vm.createComment($event)">Send</button>
    </ion-footer-bar>

</ion-modal-view>