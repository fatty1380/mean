<ion-view class="friends-screen view-section min-size" cache-view="false">

    <ion-header-bar>
        <button class="button button-icon ion-close-round" ng-click="vm.exitState();"></button>
        <h1 class="title">{{vm.title}}</h1>
        <button class="button button-clear" ng-if="vm.canEdit" ng-click="vm.showRequestsModal();"><span ng-if="vm.newRequests" class="badge badge-assertive">{{vm.newRequests}}</span> Requests</button>
    </ion-header-bar>

    <ion-pane class="friends-pane" ng-class="{'has-footer':vm.canEdit && !!vm.friends.length}">
        <div class="item item-input search-bar">
            <i class="icon light ion-ios-search-strong"></i>
            <input type="search" debounce 
            placeholder="{{!vm.friends.length ? 'Find TruckerLine Users' : 'Search'}}" 
            ng-model="vm.searchText"
            ng-change="vm.canEdit && vm.searchHandler()">
        </div>

        <ion-scroll delegate-handle="main-content-scroll">
            <!-- Friends -->
            <div class="title" ng-if="vm.yourFriendsTitle">{{vm.yourFriendsTitle}}</div>
            <ul class="list friends-list user-friends-list" ng-if="vm.friends.length">
                <li class="item" ng-repeat="friend in friends = (vm.friends | filter:vm.searchText)" ng-click="vm.viewUser(friend, $event)"
                ng-init="vm.initUser(friend)">
                    <img ng-if="!!(friend.avatar)" ng-src="{{friend.avatar}}" />
                    <i ng-if="!(friend.avatar)" class="ico ico-avatarsmall"></i>
                    <div class="item-content">
                        <strong>{{friend.handle}}</strong>  {{friend.displayName}}
                    </div>
                    <button class="button button-small list-button" ng-click="vm.messageFriend(friend, $event);" ng-if="friend.isFriend && !friend.isSelf">
                        Message
                    </button>
                    <button ng-if="!friend.isFriend && !friend.isSelf" class="button button-small list-button" ng-click="vm.addFriend(friend, $event)">
                        Add
                    </button>
                </li>
                <li ng-if="vm.friends && !friends.length" class="no-matches">
                    <div class="item-content">NO MATCHES</div>
                </li>
            </ul>

            <!--These Sections will only be shown when a user is viewing their own friends list-->
            <span ng-if="vm.canEdit">
                <!-- No friends -->
                <div class="no-content" ng-if="!vm.searchText && !vm.friends.length">
                    <h3>Grow your Convoy!</h3>
                    <p>Start with the 5 best drivers you know and help grow your personal network of professional truck drivers.</p>
                    <p>Select from your device contacts or manually by Mobile Phone or Email</p>
                    <br>
    
                    <button class="button button-block button-positive" ng-click="vm.showAddFriendsModal()">
                        Choose from Contact List
                    </button>
    
                    <div class="button-holder text-center" ng-if="!contacts.length">
                        <a class="button button-clear manual-add" ng-click="vm.addManually()">
                            <i class="icon ion-ios-plus-outline"></i>
                            Add by Mobile Phone or Email
                        </a>
                    </div>
                </div>
    
                <!-- Outset users -->
                <div class="title" ng-if="vm.searchText.length >= 3 || vm.users.length">TruckerLine Users</div>
                <ul class="list friends-list" ng-if="vm.users.length && !contacts.length && vm.searchText.length >= 2">
                    <li class="item" ng-repeat="user in vm.users" ng-click="vm.viewUser(user, $event)" ng-init="vm.initUser(user)">
                        <i class="ico ico-avatarsmall" ></i>
                        <div class="item-content">
                            <strong>{{user.handle}}</strong>
                            {{user.displayName}}
                        </div>                        
                        
                    <button ng-show="user.friendStatus === 'friends'" class="button button-small list-button" ng-click="vm.messageFriend(friend, $event);" >
                        Message
                    </button>
                    <button ng-show="user.friendStatus === 'sent'" class="button button-small list-button button-balanced" ng-click="$event.stopPropagation();" >
                        Invited
                    </button>
                    <button ng-show="user.friendStatus === 'pending'" class="button button-small list-button button-balanced" ng-click="vm.acceptFriend(user, $event)"  >
                        <i class="ion-plus"></i> Accept
                    </button>
                    <button ng-show="user.friendStatus === 'none'" class="button button-small list-button" ng-click="vm.addFriend(user, $event)" >
                        <i class="ion-plus"></i> Add
                    </button>
                        
                    </li>
                </ul>
                <div ng-if="vm.searchText.length >= 3 && !vm.users.length" class="no-matches">
                    <div class="item-content">No Users Found. Please, try to edit your search query.</div>
                </div>
            </span>

        </ion-scroll>
    </ion-pane>

    <ion-footer-bar ng-if="vm.canEdit && !!vm.friends.length">
        <div class="button-bar">
            <button class="button block-button" ng-click="vm.showAddFriendsModal()">Invite Friends</button>
        </div>
    </ion-footer-bar>

</ion-view>