<ion-view class="profile-screen view-section mid-size" cache-view="false">
    <!--Profile Main Heading START-->
    <ion-header-bar align-title="center">
        <button ng-if="!!vm.showEditModal" class="button button-clear" ng-click="vm.showEditModal()"><i class="ion-compose"></i> Edit</button>
        <button ng-if="!vm.showEditModal" class="button button-clear" ng-click="vm.goBack()">
            <i class="ion-ios-arrow-back"></i>
            <span class="ico ico-avatarsmall ico-middle"></span>
        </button>
        <h1 class="title" ng-bind="vm.profileData.displayName">Profile</h1>
        <button class="button button-clear" ng-if="!!vm.showUserSettings" ng-click="vm.showUserSettings()">
            <i class="ico ico-settingsicon ico-text-top"></i>
        </button>
        <button class="button button-clear" ng-if="!!vm.doFriendAction" ng-click="vm.doFriendAction()">
            <span ng-if="vm.friendStatus === 'none'"><i class="ion-plus"></i> Add</span>
            <span ng-if="vm.friendStatus === 'sent'" class="badge badge-balanced">invited</span>
            <span ng-if="vm.friendStatus === 'pending'" class="badge badge-balanced"><i class="ion-plus"></i> Accept</span>
            <span ng-if="vm.friendStatus === 'friends'" class="badge badge-positive">in convoy</span>
        </button>
    </ion-header-bar>

    <div class="profile-visual">
        <div class="photo" ng-click="vm.showEditAvatar()">
            <img ng-if="vm.profileData.profileImageURL" ng-src="{{vm.profileData.profileImageURL}}" alt="" />
        </div>
        <div class="contacts-amount" ng-click="vm.showFriends($event);">
            <span class="ico ico-friends ico-middle" ng-click="vm.showFriends($event);"></span>
            <span ng-if="vm.canEdit && vm.updates.requests" class="badge badge-assertive" ng-click="vm.showFriends($event);">{{vm.updates.requests}}</span>
            <strong ng-click="vm.showFriends($event);">{{vm.profileData.friends.length}}</strong>
        </div>
        <div class="handle" ng-if="!!vm.profileData.handle">
            <strong><i class="ico ico-radio"></i> {{vm.profileData.handle}}</strong>
        </div>
    </div>
    <!--Profile Main Heading END-->

    <!--Profile Main Body START-->
    <ion-pane class="profile-pane">
        <ion-tabs class="profile-tabs tabs-top content-pane" delegate-handle="profile-tabs">
            <ion-tab title="REVIEWS" ui-sref="account.profile.reviews({userId: vm.profileData && vm.profileData.id || null})" on-select="vm.showReviewTab()"
            ng-class="{'has-button': !!vm.showRequestReviewModal}" badge="vm.canEdit && vm.getReviewBadge()" badge-style="{{!vm.welcomeReview ? 'badge-energized' : 'badge-assertive'}}">

                <ion-scroll class="reviews-list">
                    <ion-list ng-if="vm.reviews && vm.reviews.length">
                        <ion-item class="item" ng-repeat="review in vm.reviews track by $index">
                            <div class="ico ico-avatarsmall"></div>
                            <div class="review">
                                <div class="top">
                                    <rating ng-if="!!review.rating" readonly="true" ng-model="review.rating" max="5"></rating>
                                    <div class="time"><i class="ico ico-timesmall"></i> {{review.created | date : 'mediumDate'}}</div>
                                </div>
                                <strong class="title">{{review.name}} - {{review.title}}</strong>
                                <div class="message">{{review.text}}</div>
                            </div>
                        </ion-item>
                    </ion-list>

                    <div ng-if="vm.canEdit && (!vm.reviews || !vm.reviews.length)" class="no-content">
                        <p class="message">This is your Reviews Section where you can request reviews from people you have worked with previously.
                            Use reviews as your place to show your professionalism and work ethic in ways that traditional
                            driver reports canâ€™t!</p>
                        <p class="message">Get started with the <strong>Request Review</strong> button below</p>
                    </div>
                    <div class="no-content" ng-if="!vm.canEdit">
                        <p class="message">
                            {{::vm.profileData.firstName}} does not have any reviews yet. If you would like to review {{::vm.profileData.firstName}},
                            <a ui-sref="account.messages({recipientId: vm.profileData.id})">send a message</a> and ask them
                            to send you a Review Request.
                        </p>

                    </div>

                </ion-scroll>

                <div class="button content-button" ng-if="!!vm.showRequestReviewModal" ng-click="vm.showRequestReviewModal()">
                    <button type="button" class="button button-block button-positive">
                        <i class="ion-clipboard"></i> Request Review
                    </button>
                </div>

            </ion-tab>
            <ion-tab title="PROFILE" ui-sref="account.profile({userId: vm.profileData && vm.profileData.id || null})" class="content-pane"
            on-select="vm.showProfileTab()" ng-class="{'has-button': !!vm.showShareModal || !vm.canEdit}">
                <ion-scroll class="profile-list">
                    <div class="list">
                        <div class="item" ng-if="!!vm.profileData.props.title">
                            <span class="item-label">CURENT JOB TITLE:</span>
                            <span class="item-note">{{vm.profileData.props.title}}</span>
                        </div>
                        <div class="item">
                            <span class="item-label" ng-click="vm.ab()">TRUCK:</span>
                            <span class="item-note">
                                <div class="logo">
                                    <i ng-if="vm.trucksMap[vm.profileData.props.truck]" class="{{vm.trucksMap[vm.profileData.props.truck]}}"></i>
                                    <div ng-if="!!vm.profileData.props.truck && !vm.trucksMap[vm.profileData.props.truck]">{{vm.profileData.props.truck}} {{vm.profileData.props.model}}</div>
                                    <div ng-if="!vm.profileData.props.truck && vm.profileData.props.model">{{vm.profileData.props.model}}</div>
                                    <span ng-if="vm.trucksMap[vm.profileData.props.truck] && vm.profileData.props.model" class="badge badge-positive">
                                        {{vm.profileData.props.model}}
                                    </span>
                        </div>
                        </span>
                    </div>
                    <div class="item">
                        <span class="item-label">TRAILER:</span>
                            <span class="item-note">
                                <span ng-repeat="trailer in vm.profileData.props.trailer">
                                    {{trailer}}<span ng-if="!$last">, </span>
                            </span>
                        </span>
                    </div>
                    <div class="item" ng-if="!!vm.profileData.props.started">
                        <span class="item-label">DRIVING SINCE:</span>
                        <span class="item-note">{{vm.profileData.props.started | monthDate | date : 'MMMM, yyyy'}}</span>
                    </div>
                    <div class="item item-divider"></div>
                    <div class="item" ng-if="!!vm.profileData.props.company">
                        <span class="item-label">DRIVING FOR:</span>
                        <span class="item-note">{{vm.profileData.props.company}}</span>
                    </div>
                    <div class="item" ng-if="vm.profileData.props.freight">
                        <span class="item-label"><span class="ico ico-freight"></span> FREIGHT:</span>
                        <span class="item-note">{{vm.profileData.props.freight}}</span>
                    </div>
                    <div class="item endorsements-row">
                        <span class="item-label">LICENSE:</span>
                        <!--<i class="ico extra-small-size {{'ico-license' + vm.profileData.license.class.toLowerCase() + 'active' }}"></i>-->
                        <ul class="endorsements-list" ng-click="vm.showEndorsements()">
                            <li ng-if="vm.profileData.license.class" class="license"><span class="ltxt">{{vm.profileData.license.class}}</span></li>
                            <li ng-repeat="endorsement in vm.profileData.license.endorsements">
                                <i class="ico extra-small-size {{ vm.endorsementsMap[endorsement].ico}}"></i>
                            </li>
                        </ul>
                    </div>

                    <div class="item item-divider" ng-if="vm.feed"></div>

                    <div class="item activity profile-activity" ng-if="vm.feed">
                        <span class="item-label">ACTIVITY:</span>
                        <div class="text-center item-loading" ng-if="vm.feedLoading">
                            <ion-spinner></ion-spinner>
                        </div>
                        <oset-feed-item ng-if="vm.feed.length" ng-repeat="entry in vm.feed" model="entry"></oset-feed-item>
                        <div ng-if="!vm.feed.length && !vm.feedLoading" class="no-feed-items">{{ vm.feedMessage }}</div>
                    </div>

                    </div>
                    <!--<div class=" activity list"></div>-->
                </ion-scroll>

                <div class="button content-button" ng-if="!!vm.showShareModal" ng-click='vm.showShareModal()'>
                    <button type="button" class="button button-block button-positive">
                        <i class="ion-share"></i> Share
                    </button>
                </div>
                <div class="button content-button" ng-if="!vm.canEdit" ng-click="vm.openChat()">
                    <button type="button" class="button button-block button-positive">
                        <i class="ion-chatbubbles"></i> Send Message
                    </button>
                </div>

            </ion-tab>

            <ion-tab title="EXPERIENCE" ui-sref="account.profile.experience({userId: vm.profileData && vm.profileData.id || null})" on-select="vm.showExperienceTab()"
            ng-class="{'has-button': !!vm.showAddExperienceModal}" badge="vm.canEdit && vm.getExperienceBadge()" badge-style="badge-energized">

                <ion-scroll class="experience-list">
                    <tline-experience-list ng-model="vm.experience" show-add-button="false" can-edit="vm.canEdit" show-add-fn="vm.showAddExperienceModal"
                    instructText="vm.expInstructText"></tline-experience-list>
                </ion-scroll>

                <div class="button content-button" ng-if="!!vm.canEdit && !!vm.showAddExperienceModal" ng-click="vm.showAddExperienceModal()">
                    <button type="button" class="button button-block button-positive">
                        <i class="ion-plus"></i> Add Experience
                    </button>
                </div>

            </ion-tab>
        </ion-tabs>
    </ion-pane>

</ion-view>