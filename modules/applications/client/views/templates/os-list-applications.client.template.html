<section class="application-list">

    <div class="row">
        <div class="job-list blog-category-list">

            <article class="post col-sm-12"
                     ng-if="vm.jobs" ng-repeat="job in vm.jobs"
                     ng-show="vm.visibleJob === job._id || !vm.visibleJob">
                <div class="post-inner">
                    <div class="content">
                        <div class="date-label">
                            <span class="month">{{(job.posted || job.created)  | amDateFormat : 'MMM' | uppercase}}</span>
                            <span class="date-number">{{job.posted | amDateFormat : 'd'}}</span>
                        </div>
                        <h3 class="post-title">{{job.name}}</h3>

                        <!--meta-->
                        <div class="post-entry pull-right">
                            <a class="read-more strong" ng-click="vm.visibleJob = job._id"
                               href="#{{job._id}}/applicants">
                                <i class="fa fa-users fa-lg mgn-right"></i>{{job.applications.length || '0'}} Applicants
                            </a>
                            <a class="read-more strong mgn-left"><i class="fa fa-lg fa-file-text mgn-right"></i>View
                                Description</a>
                            <a class="read-more strong mgn-left" ui-sref="jobs.edit({jobId: job._id})">
                                <i class="fa fa-external-link fa-lg mgn-right"></i>Edit
                            </a>
                            <a class="read-more strong mgn-left" ng-click="vm.visibleJob = null"
                               ng-class="{'disabled':!vm.visibleJob}">
                                <i class="fa fa-close fa-lg mgn-right"></i>
                            </a>
                        </div>
                    </div>

                    <div class="row">
                        <div class="post-entry col-sm-12" ng-show="vm.visibleJob === job._id">

                            <table class="table" ng-if="job.applications && job.applications.length">
                                <thead>
                                <tr>
                                    <th></th>
                                    <th>Applicant</th>
                                    <th class="hidden-sm"></th>
                                    <th></th>
                                    <th></th>
                                </tr>
                                </thead>
                                <tbody>
                                <tr data-ng-repeat="application in job.applications"
                                    ng-init="user = application.user; driver = user.driver; license = driver.licenses[0]"
                                    ui-sref="applications.view({'applicationId': application._id})" ng-class="{'disabled': application.disabled}">
                                    <td>{{$index+1}}</td>
                                    <td><img ng-src="{{user.profileImageURL}}"
                                             class="profile-image medium center-block">
                                    </td>
                                    <td>
                                        <span class="stronger">{{user.firstName}}&nbsp;{{user.lastName.substring(0,1)}}</span>
                                        <br>
                                            <span ng-show="application.isNew"
                                                  class="label label-primary">UNREVIEWED</span>
                                            <span ng-show="application.isConnected && application.connection.isValid && application.connection.remainingDays >= 5"
                                                  class="label label-success">CONNECTED</span>
                                            <span ng-show="application.isConnected && application.connection.isValid && application.connection.remainingDays < 5"
                                                  class="label label-warning">EXPIRES SOON</span>
                                            <span ng-show="application.isConnected && !application.connection.isValid"
                                                  class="label label-danger">EXPIRED</span>
                                            <span ng-show="application.isRejected || application.isDeleted"
                                                  class="label label-danger">{{application.status | uppercase}}</span>
                                    </td>
                                    <td>
                                        <dl class="dl-horizontal">
                                            <dt>License</dt>
                                            <dd>{{license.type.toLowerCase()==='commercial' ? 'CDL Class ' +
                                                license.rating.toUpperCase(): 'Standard License'}}
                                            </dd>
                                            <dt>Endorsements</dt>
                                            <dd><span ng-repeat="(name, val) in license.endorsements"
                                                      class="endorsement label label-success mgn-right">{{name}}&nbsp;</span></span>
                                            </dd>
                                            <dt>Interests</dt>
                                            <dd><span
                                                    ng-repeat="interest in visibleInterests = (driver.interests | filter: {value: true})"
                                                    class="label label-primary mgn-right">{{interest.key}}&nbsp;</span></span>
                                            </dd>
                                            <dt>Intro</dt>
                                            <dd ng-bind-html="application.introduction | limitTo : 75"></dd>
                                        </dl>
                                    </td>
                                    <td>
                                        <a class="read-more strong align-right"
                                           ui-sref="applications.view({applicationId: application._id, action: 'read'})">
                                            Review<i class="fa fa-external-link fa-lg mgn-left"></i>
                                        </a>
                                        <br>
                                        <a class="read-more align-right"
                                           ng-click="vm.setApplicationStatus(job.applications[$index], 'rejected', $event, this)">
                                            Reject<i class="fa fa-close fa-lg mgn-left"></i>
                                        </a>

                                    </td>
                                </tr>
                                </tbody>
                            </table>


                            <div class="list-group" ng-if="!job.applications || !job.applications.length"
                                 ng-show="vm.visibleJob === job._id">
                                <div class="list-group-item text-center">
                                    <h4>No one has applied to this job yet. Would you like to <a
                                            ui-sref="jobs.edit({'jobId':job._id})">edit
                                        your post?</a></h4>
                                </div>

                            </div>


                        </div>
                    </div>
                    <!--//content-->
                </div>
                <!--//post-inner-->
            </article>
            <!--//post-->

        </div>
    </div>

    <div class="row" ng-if="false">

        <div data-ng-class="{'panel panel-default': !!vm.header}" data-ng-if="vm.config.list">

            <div ng-if="!vm.jobs" class="list-group" data-ng-if="vm.displayMode !== 'table'">
                <a data-ng-repeat="application in vm.applications"
                   data-ui-sref="applications.view({applicationId: '{{application._id}}' })" class="list-group-item">
                    <os-view-application display-mode="{{vm.displayMode || normal}}"
                                         model="application"></os-view-application>

                    <pre>{{application | prettyPrint}}</pre>
                </a>
            </div>

            <table data-ng-if="vm.displayMode === 'table'" style="width: 100%;">
                <thead>
                <tr>
                    <td>Applicant</td>
                    <td>Updated</td>
                    <td>Messages</td>
                </tr>
                </thead>
                <tbody>
                <tr data-ng-repeat="application in vm.applications"
                    data-ui-sref="applications.view({applicationId: application._id})">
                    <td>{{application.user.firstName || application.user.displayName}}
                    </td>
                    <td data-ng-bind="application.modified | date:dateShort"></td>
                    <td>{{application.messages.length}}&nbsp;<span class="label label-info pull-right">{{application.status}}</span>
                    </td>
                    <!--<os-view-application display-mode="{{vm.displayMode || 'table'}}" model="application"></os-view-application>-->
                </tr>
                </tbody>
            </table>
            <div class="text-center" data-ng-hide="!vm.applications.$resolved || vm.applications.length">
                <p>{{::noItemsText}}</p>
            </div>
        </div>
    </div>
</section>
