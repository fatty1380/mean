<section name="os-job-list.directive" class="outset-list">
    <div class="panel panel-default search-section" data-ng-if="!!vm.showSearch && !!vm.jobs.length">
        <form class="panel-body form-inline">
            <label class="form-label" for="job-search">Search: </label>

            <div class="form-group search">
                <input id="job-search" ng-model="vm.searchTerms" type="search"
                       class="form-control job-search"
                       ng-model-options="{ updateOn: 'default blur', debounce: { 'default': 300, 'blur': 0 } }"
                       placeholder="search terms ...">
            </div>

            <div class="btn-group pull-right">
                <label class="btn btn-cta-secondary btn-sm"
                       ng-click="vm.toggleFilterMine()" btn-checkbox
                       ng-model="vm.filters.mine" name="mine">My Jobs</label>
                <label class="btn btn-cta-secondary btn-sm"
                       ng-click="vm.toggleFilter('today')" btn-checkbox
                       ng-model="vm.filters.day" name="newest">New Today</label>
                <label class="btn btn-cta-secondary btn-sm"
                       ng-click="vm.toggleFilter('week')" btn-checkbox
                       ng-model="vm.filters.week" name="newest">New This Week</label>
                <label class="btn btn-cta-secondary btn-sm hidden"
                       ng-click="vm.toggleFilter('unseen')" btn-checkbox
                       ng-model="vm.filters.unseen" name="unseen">Unseen</label>
                <label class="btn btn-cta-secondary btn-sm"
                       ng-click="vm.toggleFilter('clear')" btn-checkbox
                       ng-class="{'disabled' : vm.filters.clear}"
                       ng-model="vm.filters.clearStuff"
                       name="unseen"><i class="fa fa-times"></i></label>
            </div>

            <div class="btn-group pull-right" role="group" aria-label="...">
                <button type="button" class="btn btn-link" ng-click="vm.toggleSort('posted',true)">
                    Posting Date <i class="fa" ng-class="{'fa-sort-amount-desc':vm.reverse, 'fa-sort-amount-asc':!vm.reverse}"></i>
                </button>
            </div>
        </form>
    </div>

    <div class="row">
        <div class="job-list blog-category-list">

            <div class="row" ng-if="vm.debug">
                <pre>{{vm.user}}</pre>
            </div>
            <!--data-ng-repeat="job in (vm.jobs | filter: vm.searchTermFilter | orderBy: vm.predicate : vm.reverse | limitTo: vm.limitTo)"-->

            <article class="post col-sm-12"
                     data-ng-repeat="job in (vm.jobs | filter: vm.filter | withinPastDays: 'posted': vm.filters.numDays | filter: vm.searchTermFilter | orderBy: vm.predicate : vm.reverse  | limitTo: vm.limitTo)"
                     ng-if="vm.jobs"
                     ng-show="vm.visibleJob === job._id || !vm.visibleJob">
                <div class="post-inner">
                    <div class="content">
                        <div class="date-label">
                            <span class="month">{{(job.posted || job.created)  | amDateFormat : 'MMM' | uppercase}}</span>
                            <span class="date-number">{{job.posted | amDateFormat : 'D'}}</span>
                        </div>
                        <h3 class="post-title">{{job.name}}</h3>

                        <pre ng-if="vm.debug">Job: {{job}}</pre>
                        <!--meta-->
                        <div class="row">
                            <div class="pull-right">
                                <button type="button" class="btn-tab btn-link read-more strong"
                                        ng-click="vm.showTab()" ng-class="{'hidden':!vm.visibleJob}">
                                    <i class="fa fa-close fa-lg mgn-right"></i>
                                </button>
                                <button type="button" class="btn-tab btn-link read-more strong"
                                        ng-click="vm.showTab(job._id, 'applicants')"
                                        ng-show="job.company._id === (vm.companyId || vm.user.company.id)"
                                        ng-class="{'active': vm.visibleJob === job._id && vm.visibleTab === 'applicants'}"
                                        href="#{{job._id}}#applicants">
                                    <i class="fa fa-users fa-lg mgn-right"></i>{{job.applications.length}} Applicants
                                </button>
                                <button type="button" class="btn-tab btn-link read-more strong mgn-left"
                                        ng-click="vm.showTab(job._id, 'details')"
                                        ng-class="{'active': vm.visibleJob === job._id && vm.visibleTab === 'details'}"
                                        href="#{{job._id}}#details">
                                    <i class="fa fa-lg fa-file-text mgn-right"></i>View Description
                                </button>
                                <button type="button" class="btn-tab btn-link read-more strong mgn-left"
                                        ui-sref="jobs.edit({jobId: job._id})"
                                        ng-show="job.company._id === (vm.companyId || vm.user.company.id)">
                                    <i class="fa fa-edit fa-lg mgn-right"></i>Edit
                                </button>
                                <button type="button" class="btn-tab btn-link read-more strong mgn-left"
                                        ui-sref="jobs.view({jobId: application._id})">
                                    <i class="fa fa-external-link fa-lg mgn-right"></i>Review
                                </button>
                            </div>
                        </div>

                        <div class="row  tab-body" ng-show="vm.visibleJob === job._id">
                            <div class="post-entry col-sm-10 col-sm-offset-1" ng-show="vm.visibleTab === 'applicants'">
                                <table class="table" ng-if="job.applications && job.applications.length">
                                    <thead>
                                    <tr>
                                        <th></th>
                                        <th>Applicant</th>
                                        <th class="hidden-sm"></th>
                                        <th></th>
                                        <th></th>
                                    </tr>
                                    </thead>
                                    <tbody>
                                    <tr data-ng-repeat="application in job.applications"
                                        ng-init="user = application.user; driver = user.driver; license = driver.licenses[0]"
                                        ui-sref="applications.view({'applicationId': application._id})"
                                        ng-class="{'disabled': application.disabled}">
                                        <td>{{$index+1}}</td>
                                        <td><img ng-src="{{user.profileImageURL}}"
                                                 class="profile-image medium center-block">
                                        </td>
                                        <td>
                                            <span class="stronger">{{user.firstName}}&nbsp;{{user.lastName.substring(0,1)}}</span>
                                            <br>
                                            <os-application-status-badge
                                                    model="application"></os-application-status-badge>
                                        </td>
                                        <td>
                                            <dl class="dl-horizontal">
                                                <dt>License</dt>
                                                <dd>{{license.type.toLowerCase()==='commercial' ? 'CDL Class ' +
                                                    license.rating.toUpperCase(): 'Standard License'}}
                                                </dd>
                                                <dt>Endorsements</dt>
                                                <dd><span ng-repeat="(name, val) in license.endorsements"
                                                          class="endorsement label label-success mgn-right">{{name}}&nbsp;</span></span>
                                                </dd>
                                                <dt>Interests</dt>
                                                <dd><span
                                                        ng-repeat="interest in visibleInterests = (driver.interests | filter: {value: true})"
                                                        class="label label-primary mgn-right">{{interest.key}}&nbsp;</span></span>
                                                </dd>
                                                <dt>Intro</dt>
                                                <dd ng-bind-html="application.introduction | limitTo : 75"></dd>
                                            </dl>
                                        </td>
                                        <td>
                                            <a class="read-more strong align-right"
                                               ui-sref="applications.view({applicationId: application._id, action: 'read'})">
                                                Review<i class="fa fa-external-link fa-lg mgn-left"></i>
                                            </a>
                                            <br>
                                            <a class="read-more align-right"
                                               ng-click="vm.setApplicationStatus(job.applications[$index], 'rejected', $event, this)">
                                                Reject<i class="fa fa-close fa-lg mgn-left"></i>
                                            </a>

                                        </td>
                                    </tr>
                                    </tbody>
                                </table>

                                <div class="list-group" ng-if="!(job.applications && job.applications.length)"
                                     ng-show="vm.visibleJob === job._id">
                                    <div class="list-group-item text-center">
                                        <h4>No one has applied to this job yet. Would you like to <a
                                                ui-sref="jobs.edit({'jobId':job._id})">edit
                                            your post?</a></h4>
                                    </div>

                                </div>
                            </div>

                            <div class="post-entry col-sm-10 col-sm-offset-1" ng-show="vm.visibleTab === 'details'">
                                <h4>Description</h4>

                                <p ng-bind-html="job.description">No Description Available</p>
                                <h4>Requirements</h4>

                                <p ng-bind-html="job.requirements">No Requirements Listed</p>
                            </div>
                        </div>
                        <a class="read-more strong pull-right" ng-click="vm.visibleJob = null"
                           ng-class="{'hidden':!vm.visibleJob}"> </a>
                    </div>
                    <!--//content-->
                </div>
                <!--//post-inner-->
            </article>
            <!--//post-->

        </div>
    </div>
</section>
